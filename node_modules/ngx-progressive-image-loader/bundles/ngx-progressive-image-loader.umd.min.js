!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("ngx-window-token"),require("@angular/platform-browser"),require("@angular/core")):"function"==typeof define&&define.amd?define("ngx-progressive-image-loader",["exports","@angular/common","ngx-window-token","@angular/platform-browser","@angular/core"],t):t(e["ngx-progressive-image-loader"]={},e.ng.common,e.ngxWindowToken,e.ng.platformBrowser,e.ng.core)}(this,function(e,t,r,i,o){"use strict";var n=function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},s=new o.InjectionToken("Image loader Config"),a={rootMargin:"10px",threshold:[.1,.5,1],imageRatio:16/9,placeholderImageSrc:"",isAggressiveLoading:!0,concurrentLoading:4},c=function(){function e(e){this.setConfig(e)}return e.prototype.setConfig=function(e){this.config=e?n({},a,e):a},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[s]}]}]},e}();function g(e){return e&&"IntersectionObserver"in e&&"IntersectionObserverEntry"in e&&"intersectionRatio"in e.IntersectionObserverEntry.prototype}function l(e,t,r){e.setAttribute(r,t,r.dataset[t])}function d(e){return"PICTURE"===e.nodeName}function p(e,t){if(d(t.parentElement))for(var r=t.parentElement.children,i=0;i<r.length;i++){var n=r[i];n instanceof HTMLSourceElement?l(e,"srcset",n):n instanceof HTMLImageElement&&l(e,"src",n)}else t.dataset.src&&l(e,"src",t),t.dataset.srcset&&l(e,"srcset",t)}function h(e){return e&&!("onscroll"in e)||/(gle|ing|ro)bot|crawl|spider/i.test(e.navigator.userAgent)}var u=function(){function e(e,t,r,i){this._Renderer=e,this._ConfigurationService=t,this.platformId=r,this.window=i,this.targetMap=new Map,this.targetQueue=[],this.loading=0}return Object.defineProperty(e.prototype,"isObservable",{get:function(){return!!this.intersectionObserver},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.isAggressiveLoading===undefined&&(this.isAggressiveLoading=this._ConfigurationService.config.isAggressiveLoading),this.concurrentLoading===undefined&&(this.concurrentLoading=this._ConfigurationService.config.concurrentLoading),this.window&&g(this.window)&&!h(this.window)&&t.isPlatformBrowser(this.platformId)&&(this.imageRatio||(this.imageRatio=this._ConfigurationService.config.imageRatio),this.filter||(this.filter=this._ConfigurationService.config.filter),this.placeholderImageSrc||(this.placeholderImageSrc=this._ConfigurationService.config.placeholderImageSrc),this.intersectionObserver=new IntersectionObserver(this.onIntersectionChanged.bind(this),this._ConfigurationService.config))},e.prototype.observe=function(e){e.style.minHeight="1rem",this.intersectionObserver.observe(e),this.targetMap.set(e.dataset.src,e),this.targetQueue.push(e.dataset.src)},e.prototype.unobserve=function(e){e.style.minHeight="initial",this.targetMap["delete"](e.dataset.src),this.intersectionObserver.unobserve(e)},e.prototype.imageLoaded=function(){for(this.loading--;this.isAggressiveLoading&&this.targetQueue&&this.targetQueue.length&&this.loading<=this.concurrentLoading;){var e=this.targetQueue.shift();this.targetMap.has(e)&&this.loadImage(this.targetMap.get(e))}},e.prototype.onIntersectionChanged=function(e,t){var r=this;e.forEach(function(e){e.isIntersecting&&r.loadImage(e.target)})},e.prototype.loadImage=function(e){this.unobserve(e),this.loading++,p(this._Renderer,e)},e.prototype.reset=function(){this.targetQueue=[],this.targetMap=new Map,this.isObservable&&this.intersectionObserver.disconnect()},e.prototype.ngOnDestroy=function(){this.isObservable&&this.intersectionObserver.disconnect(),this.intersectionObserver=this.targetQueue=this.targetMap=undefined},e.decorators=[{type:o.Component,args:[{selector:"ngx-progressive-image-loader",exportAs:"ngxProgressiveImageLoader",template:"\n    <ng-content></ng-content>\n  ",changeDetection:o.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:o.Renderer2},{type:c},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]},{type:undefined,decorators:[{type:o.Optional},{type:o.Inject,args:[r.WINDOW]}]}]},e.propDecorators={imageRatio:[{type:o.Input}],concurrentLoading:[{type:o.Input}],isAggressiveLoading:[{type:o.Input}],filter:[{type:o.Input}],placeholderImageSrc:[{type:o.Input}]},e}(),m=function(){function e(e,t){this.sanitizer=e,this._ProgressiveImageLoader=t,this["class"]="ngx-image-placeholder"}return Object.defineProperty(e.prototype,"placeHolder",{get:function(){return this.sanitizer.bypassSecurityTrustStyle("padding-bottom: "+100/(this.imageRatio||this._ProgressiveImageLoader.imageRatio)+"%;")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageFilter",{get:function(){return this.sanitizer.bypassSecurityTrustStyle(""+this._ProgressiveImageLoader.filter)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"safeLoadingImage",{get:function(){return this.sanitizer.bypassSecurityTrustUrl(this.placeholderImageSrc||this._ProgressiveImageLoader.placeholderImageSrc)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){},e.decorators=[{type:o.Component,args:[{selector:"ngx-image-placeholder",template:'\n    <img class="placeholder-loading-image" [src]="safeLoadingImage" [style.filter]="imageFilter" />\n    <ng-content></ng-content>\n  ',changeDetection:o.ChangeDetectionStrategy.OnPush}]}],e.ctorParameters=function(){return[{type:i.DomSanitizer},{type:u}]},e.propDecorators={"class":[{type:o.HostBinding,args:["class"]}],placeHolder:[{type:o.HostBinding,args:["style"]}],imageRatio:[{type:o.Input}],placeholderImageSrc:[{type:o.Input}]},e}(),f=function(){function e(e,t,r,i,n){this._ElementRef=e,this._Renderer=t,this._ConfigurationService=r,this._ImagePlaceholder=i,this._ProgressiveImageLoader=n,this.noPlaceholder=!1,this.onImageLoaded=new o.EventEmitter,this.isObserved=!1}return Object.defineProperty(e.prototype,"imageRatio",{get:function(){return this._imageRatio||this._ProgressiveImageLoader.imageRatio},set:function(e){this._imageRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderImageSrc",{get:function(){return this._placeholderImageSrc||this._ProgressiveImageLoader.placeholderImageSrc},set:function(e){this._placeholderImageSrc=e},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.imageElement=this._ElementRef.nativeElement,this.setDataSrc("data-src",this.src),this.setDataSrc("data-srcset",this.srcset),this._ProgressiveImageLoader.isObservable?this.imageElement instanceof HTMLImageElement&&(this.isObserved=!0,this._ProgressiveImageLoader.observe(this.imageElement),this.imageElement.onload=function(){e.onImageLoaded.emit(e.imageElement),e.imageElement.classList.add("loaded"),e._ProgressiveImageLoader.imageLoaded()},this._ImagePlaceholder||this.noPlaceholder||this.setPlaceholder()):(p(this._Renderer,this.imageElement),this.imageElement.classList.add("loaded"))},e.prototype.ngOnChanges=function(e){e.src&&!e.src.isFirstChange()&&this.setDataSrc("data-src",this.src),e.srcset&&!e.srcset.isFirstChange()&&this.setDataSrc("data-srcset",this.srcset),this.isObserved&&(e.src&&!e.src.isFirstChange()||e.srcset&&!e.srcset.isFirstChange())&&(this._ProgressiveImageLoader.unobserve(this.imageElement),this._ProgressiveImageLoader.observe(this.imageElement))},e.prototype.setDataSrc=function(e,t){t&&this._Renderer.setAttribute(this.imageElement,e,t)},e.prototype.setPlaceholder=function(){var e=this.imageElement.parentElement,t=this.createPlaceholder(this.createPlaceholderImage());if(d(e)){var r=e.parentElement;this.insertPlaceholder(r,e,t)}else this.insertPlaceholder(e,this.imageElement,t)},e.prototype.insertPlaceholder=function(e,t,r){e.insertBefore(r,t),r.style.paddingBottom=100/this.imageRatio+"%",r.appendChild(t)},e.prototype.createPlaceholder=function(e){var t=document.createElement("div");return t.classList.add("ngx-image-placeholder"),t.appendChild(e),t},e.prototype.createPlaceholderImage=function(){var e=new Image;return e.classList.add("placeholder-loading-image"),e.style.filter=this._ProgressiveImageLoader.filter,e.src=this.placeholderImageSrc,e},e.decorators=[{type:o.Directive,args:[{selector:"img[ngxProgressiveImage], source[ngxProgressiveImage]"}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:c},{type:m,decorators:[{type:o.Optional},{type:o.Inject,args:[m]}]},{type:u,decorators:[{type:o.Inject,args:[u]}]}]},e.propDecorators={imageRatio:[{type:o.Input}],placeholderImageSrc:[{type:o.Input}],src:[{type:o.Input}],srcset:[{type:o.Input}],noPlaceholder:[{type:o.Input}],onImageLoaded:[{type:o.Output}]},e}();function y(e){return new c(e)}var I=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:s,useValue:e},{provide:c,useFactory:y,deps:[s]}]}},t.decorators=[{type:o.NgModule,args:[{imports:[],declarations:[u,f,m],exports:[u,f,m]}]}],t}();e.ProgressiveImageLoaderComponent=u,e.ProgressiveImageDirective=f,e.ImagePlaceholderComponent=m,e.ConfigurationServiceFactory=y,e.NgxProgressiveImageLoaderModule=I,e.IMAGE_LOADER_CONFIG_TOKEN=s,e.DEFAULT_IMAGE_LOADER_OPTIONS=a,e.isSupportIntersectionObserver=g,e.isImagePicture=function v(e){return e instanceof HTMLImageElement||e instanceof HTMLPictureElement},e.setAttribute=l,e.isPictureElement=d,e.loadImage=p,e.isSpider=h,e.Éµa=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-progressive-image-loader.umd.min.js.map